# week04

### 事件循环

- 事件循环其实就是宏任务队列，既不属于 JS 引擎实现的一部分，也不属于 JS 语言规范的内容，是由宿主去实现

- 可以认为所有 JS 代码都是执行在微任务中

- 所有 JS 语言规范的 API 都是微任务，浏览器提供的 API 属于宏任务

- 微任务其实是 JS 标准内规定的任务队列，在 ES3 时代 JS 都是同步代码，由外部来提供异步任务队列，ES5 有了 Promise 所以 JS 自身也有了任务队列，所以就有宏任务和微任务之区分

- 宏任务由宿主发起，script 标签、用户 UI 交互行为、setTimeout、setInterval 都会创建宏任务，就浏览器而言，宏任务的本质就是浏览器去执行一段 JS 代码

- 微任务由 JS 引擎发起，每执行一段 JS 代码会首先产生一个微任务，然后去执行这个微任务，执行完之后会检查 JS 内部的微任务队列，如果队列不为空，则会取出队首的微任务执行，重复上述步骤直到微任务都已执行完毕，然后再由外部的事件循环去检查宏任务队列，如此往复

- Promise 里的 resolve, mutationObserver, async 函数里的 await 都会发起一个微任务
